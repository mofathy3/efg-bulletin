<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EFG Hermes Technical Bulletin</title>
<script>
async function openReport(){
  function formatDate(date){
    const yyyy = date.getFullYear();
    const mm = String(date.getMonth()+1).padStart(2,'0');
    const dd = String(date.getDate()).padStart(2,'0');
    return {yyyy,mm,dd,display:`${dd}-${mm}-${yyyy}`};
  }

  async function checkAndOpen(primaryURL, fallbackURL){
    try{
      const res = await fetch(primaryURL,{method:'HEAD'});
      if(res.ok){
        location.href = primaryURL;
      } else {
        location.href = fallbackURL;
      }
    } catch {
      location.href = fallbackURL;
    }
  }

  const base = "https://cdn.efghermes.com/Retail/Technical%20Bulletin%20Report";
  const today = new Date();
  const day = today.getDay();
  const todayFmt = formatDate(today);
  let fallbackDate = new Date(today);

  if(day===5 || day===6 || day===0){
    fallbackDate.setDate(today.getDate() - ((day===5)?1 : (day===6)?2 : 3));
  } else {
    fallbackDate.setDate(today.getDate() - 1);
  }

  const fallbackFmt = formatDate(fallbackDate);

  const urlToday = `${base}/${todayFmt.yyyy}/${todayFmt.mm}/${todayFmt.dd}/0/THE%20TECHNICAL%20BULLETIN%20${todayFmt.display}.pdf`;
  const urlFallback = `${base}/${fallbackFmt.yyyy}/${fallbackFmt.mm}/${fallbackFmt.dd}/0/THE%20TECHNICAL%20BULLETIN%20${fallbackFmt.display}.pdf`;

  await checkAndOpen(urlToday, urlFallback);
}
</script>
</head>
<body onload="openReport()">
  <h2 style="text-align:center; margin-top:40px;">Opening the latest EFG Hermes Technical Bulletin...</h2>
</body>
</html>
