<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EFG Hermes Technical Bulletin</title>
<script>
async function openReport(){
  function formatDate(date){
    const yyyy = date.getFullYear();
    const mm = String(date.getMonth()+1).padStart(2,'0');
    const dd = String(date.getDate()).padStart(2,'0');
    return {yyyy,mm,dd,display:`${dd}-${mm}-${yyyy}`};
  }

  async function checkURL(url){
    try {
      const res = await fetch(url, { method: 'HEAD' });
      return res.ok;
    } catch {
      return false;
    }
  }

  const base = "https://cdn.efghermes.com/Retail/Technical%20Bulletin%20Report";
  const today = new Date();
  const todayFmt = formatDate(today);

  const urlToday = `${base}/${todayFmt.yyyy}/${todayFmt.mm}/${todayFmt.dd}/0/THE%20TECHNICAL%20BULLETIN%20${todayFmt.display}.pdf`;

  // Wait 3 seconds before starting
  setTimeout(async () => {
    const todayExists = await checkURL(urlToday);

    if (todayExists) {
      location.href = urlToday;
    } else {
      // Prompt user for last published date (default = yesterday)
      const yesterday = new Date(today);
      yesterday.setDate(today.getDate() - 1);
      const yFmt = formatDate(yesterday);
      const input = prompt("Today's report not found.\nPlease enter last published date (DD-MM-YYYY):", yFmt.display);

      if (input) {
        const [dd, mm, yyyy] = input.split('-');
        const urlManual = `${base}/${yyyy}/${mm}/${dd}/0/THE%20TECHNICAL%20BULLETIN%20${input}.pdf`;
        location.href = urlManual;
      }
    }
  }, 3000);
}
</script>
</head>
<body onload="openReport()">
  <h2 style="text-align:center; margin-top:40px;">
    Opening the latest EFG Hermes Technical Bulletin...<br><br>
    <small>(Redirecting in 3 seconds)</small>
  </h2>
</body>
</html>
